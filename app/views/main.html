<div class="row">
  <div class="col-md-4">
    <div class="panel panel-default panel-units panel-cars" ng-init="tab=game.tabs.byName.money">
      <div class="panel-heading">
        <span ng-if="tab.isNewlyUpgradable()" title="New upgrade available" class="animif glyphicon glyphicon-circle-arrow-up pull-right"></span>
        <span>{{(tab.units | filter:filterVisible | filter:filterBought | count)-1}}</span>
        <span class="titlecase">Cars</span>
      </div>
      <div class="panel-body">
        <ul class="list-unstyled">
          <li ng-repeat="unit in tab.sortUnits() | filter:filterVisible track by unit.name" ng-if="!$last" class="clearfix">
            <button ng-repeat="upgrade in unit.upgrades.byClass.upgrade | filter:filterVisible" class="btn pull-left"
              ng-class="{'btn-primary': upgrade.isCostMet(), 'btn-default': !upgrade.isCostMet()}"
              ng-click="buy({upgrade: upgrade})">
              <p>{{upgrade.type.label}}</p>
              <p>
                <span ng-repeat="cost in upgrade.totalCost() track by cost.unit.name">
                  <span class="-resource -resource-{{cost.unit.name}}" ng-class="{costNotMet:cost.unit.count().lessThan(cost.val)}">
                    <i class="icon-resource icon-{{cost.unit.name}}"></i>
                    {{cost.val | bignum}}
                    <span class="label-resource label-{{cost.unit.name}}">
                      <span class="label-label">{{cost.val.equalTo(1)?cost.unit.unittype.label:cost.unit.unittype.plural}}</span>
                      <span class="label-suffix">{{cost.unit.suffix}}</span>
                    </span>
                  </span>
                </span>
              </p>
            </button>
            <span class="pull-right">
              <span class="titlecase">{{unit.type.label}}</span>
              <span ng-if="!unit.upgrades.byName[unit.name+'_upgrade'].count().isZero()">{{unit.upgrades.byName[unit.name+'_upgrade'].count()+""|number}}</span>
            </span>
            <span ng-init="velocityUnit = options.getVelocityUnit({prod:unit})">
              <span ng-repeat="(name, val) in unit.totalProduction()">
                <i class="icon-resource icon-{{name}}"></i>
                {{val.times(velocityUnit.mult) | longnum:2}}
                <span class="label-resource label-{{name}}" ng-init="prodUnit = game.unit(name)">
                  <span class="label-label">{{val.equalTo(1)?prodUnit.unittype.label:prodUnit.unittype.plural}}</span>
                  <span class="label-suffix">{{prodUnit.suffix}}</span>
                </span>
              </span>
            </span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="col-md-8">
    <clicker></clicker>
  </div>

<div
  ng-repeat="tab in game.tabs.list | filter:filterVisible"
  class="col-md-4">
  <div class="panel panel-default panel-units panel-{{name}}">
    <div class="panel-heading">
      <span ng-if="tab.isNewlyUpgradable()" title="New upgrade available" class="animif glyphicon glyphicon-circle-arrow-up pull-right"></span>
      {{tab.leadunit.unittype.label}}
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="table-responsive">
          <table class="table table-condensed unit-table table-hover">
            <tr ng-repeat="unit in tab.sortUnits() | filter:filterVisible track by unit.name" ng-if="!$last">
              <td class="upgrade-indicator">
                <span ng-if="unit.isNewlyUpgradable()" title="New upgrade available" class="animif glyphicon glyphicon-circle-arrow-up"></span>
              </td>
              <td>
                <button ng-disabled="!unit.isCostMet()" class="btn btn-default">
                  <p>
                  <span class="list-icon-resource icon-{{unit.name}}"></span>
                  <span class="titlecase unselectedlist-label label-{{unit.name}}">
                    <span class="label-label">{{unit.unittype.label}}</span>
                    <span class="label-suffix">{{unit.suffix}}</span>
                  </span>
                  </p>
                  <p ng-if="unit.isCostMet()">
                    +{{unit.maxCostMet().times(unit.twinMult())|bignum}}
                  </p>
                  <p ng-if="!unit.isCostMet()">
                    Can't buy
                  </p>
                </button>
              </td>
              <td class="text-right" style="padding-right: 0; white-space:nowrap">
                {{unit.count()|bignum:0}}
              </td>
              <td class="text-left" style="padding-left: 0; white-space:nowrap">
                <sup>
                  <span ng-if="!unit.velocity().isZero()">
                  +{{unit.velocity().times(options.getVelocityUnit({unit:unit}).mult)|bignum:2}}/{{options.getVelocityUnit({unit:unit}).name}}
                  </span>
                  <span ng-if="unit.velocity().isZero() && tab.name == 'territory' && !val.isZero()" ng-repeat="(name, val) in unit.totalProduction()">
                    +{{val.times(options.getVelocityUnit({unit:name}).mult)|bignum:2}}/{{options.getVelocityUnit({unit:name}).name}}</span>
                </sup>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<tabs cur="cur.tab"></tabs>

<div class="tab-content">
  <div class="tab-pane active table-responsive">
    <table class="table unit-table table-hover" style="width:auto; float:left">
      <!-- filthy hack to show achievements on larvae page -->
      <tr ng-if="cur.tab.name == 'larva' && game.upgrade('achievementbonus').count().greaterThan(0)">
        <td class="upgrade-indicator"></td>
        <td class="titlecase">
          <a href="#/achievements">
            <span class="list-icon-resource icon-achievements"></span>
            achievement points
          </a></td>
        <td>{{game.achievementPoints()|bignum:0}}</td>
        <td>+{{game.upgrade('achievementbonus').calcStats().prod|percent:{plusOne:true} }} larvae</td>
      </tr>
      <tr ng-repeat="unit in cur.tab.sortUnits() | filter:filterVisible track by unit.name">
        <td class="upgrade-indicator" ng-click="click(unit)">
          <span ng-if="unit.isNewlyUpgradable()" title="New upgrade available" class="animif glyphicon glyphicon-circle-arrow-up"></span>
        </td>
        <td ng-click="click(unit)">
          <span class="list-icon-resource icon-{{unit.name}}"></span>
          <a ng-href="#{{cur.tab.url(unit)}}" class="titlecase unselectedlist-label label-{{unit.name}}">
            <span class="label-label">{{unit.unittype.label}}</span>
            <span class="label-suffix">{{unit.suffix}}</span>
          </a>
        </td>
        <td ng-click="click(unit)">
          {{unit.count()|bignum:0}}
        </td>
        <td ng-click="click(unit)">
          <span ng-if="!unit.velocity().isZero()">
          +{{unit.velocity().times(options.getVelocityUnit({unit:unit}).mult)|bignum:2}}/{{options.getVelocityUnit({unit:unit}).name}}
          </span>
          <span ng-if="unit.velocity().isZero() && cur.tab.name == 'territory' && !val.isZero()" ng-repeat="(name, val) in unit.totalProduction()">
            +{{val.times(options.getVelocityUnit({unit:name}).mult)|bignum:2}}/{{options.getVelocityUnit({unit:name}).name}}</span>
        </td>
        <td ng-if="options.showAdvancedUnitData()">
          <buyunitdropdown unit="unit" num="1"></buyunitdropdown>
        </td>
      </tr>
    </table>
    <!-- without this, dropdown creates vertical scrollbar due to table-responsive. we want horiz scrollbars on small screens, not vert on big screens! -->
    <p style="padding-bottom:200px"></p>
  </div>
</div>

